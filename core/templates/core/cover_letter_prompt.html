<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Cover Letter Prompt</title>
    <!-- cover_letter_prompt.html: Main generator page for user input and AI cover letter -->
</head>
<body>
    <!-- Page title and instructions -->
    <h1>Enter Your Details</h1>
    <!-- Form for user profile and job prompt -->
    <form method="post">
        {% csrf_token %} <!-- CSRF token for security -->
        {{ profile_form.as_p }} <!-- Renders user profile fields -->
        {{ prompt_form.as_p }} <!-- Renders job prompt fields -->
        <button type="submit">Generate Cover Letter</button>
    </form>

    <!-- Section for displaying the generated cover letter -->
    {% if cover_letter %}
      <div id="generated-letter" style="margin-top: 2rem; padding: 1rem; background: #f4f4f4; border-left: 4px solid #3b82f6;">
        <h2>Your Generated Cover Letter</h2>
        {% if not unlocked %}
          <!-- Stripe payment unlock logic -->
          <p><strong>Unlock your cover letter for Â£2.99:</strong></p>
          <form action="/create-checkout-session/" method="POST">
            {% csrf_token %}
            <button type="submit" id="checkout-button">Pay with Stripe</button>
          </form>
          <div id="locked-letter" style="margin-top:1rem; color:#888;">
            <em>Your cover letter will be revealed after payment.</em>
          </div>
        {% else %}
          <!-- Unlocked: show the generated cover letter -->
          <pre style="white-space: pre-wrap;">{{ cover_letter }}</pre>
        {% endif %}
      </div>
    {% endif %}
</body>
</html>
